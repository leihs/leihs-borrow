name: Build borrow uberjar (Docker)

include:
  - path: cider-ci/install-ruby_task-component.yml
    submodule: [leihs-ui]

traits:
  Docker Engine: true

max_trials: 3

scripts:
  build-borrow-uberjar:
    timeout: 60 minutes
    exclusive_executor_resource: 'build-leihs-borrow-jar-docker_{{CIDER_CI_TREE_ID}}'
    start_when:
      install-ruby-passed: { script_key: install-ruby }
    body: |
      cd ${LEIHS_BORROW_DIR}

      # build with docker, prime docker cache
      IMAGE_NAME="$DIST_IMAGE_NAME" \
      VERSION_NAME="$DIST_VERSION_NAME" \
        bin/docker-build

      USE_DOCKER=YES bin/build
